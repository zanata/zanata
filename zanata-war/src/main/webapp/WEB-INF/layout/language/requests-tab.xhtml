<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:rich="http://richfaces.org/rich">
  <div class="panel">
    <div class="panel__header">
      <ui:fragment
        rendered="#{identity.hasPermission(languageAction.locale, 'manage-language-team')}">
        <h2 class="panel__heading">#{msgs['jsf.language.requests']}</h2>
      </ui:fragment>
      <ui:fragment
        rendered="#{not identity.hasPermission(languageAction.locale, 'manage-language-team')}">
        <h2 class="panel__heading">#{msgs['jsf.language.myRequests']}</h2>
      </ui:fragment>
    </div>

    <h:form id="requests-form" styleClass="l--push-bottom-0">
      <script type="text/javascript">
        function toggleActions(id, accept) {
          jQuery('#' + id + '-accept').attr('disabled', true);
          jQuery('#' + id + '-accept-label').addClass('is-disabled');
          jQuery('#' + id + '-decline').attr('disabled', true);
          jQuery('#' + id + '-decline-label').addClass('is-disabled');

          if(accept) {
            jQuery('#' + id + '-decline').addClass('is-hidden');
            jQuery('#' + id + '-decline-label').addClass('is-hidden');

            jQuery('#' + id + '-actions').addClass('is-hidden');
            jQuery('#' + id + '-actions-roles').removeClass('is-hidden')
          } else {
            jQuery('#' + id + '-accept').addClass('is-hidden');
            jQuery('#' + id + '-accept-label').addClass('is-hidden');
          }
        }
      </script>

      <a4j:jsFunction name="acceptRequest"
        action="#{languageJoinAction.acceptRequest(langRequestId)}"
        oncomplete="refreshRequestsSize();toggleActions(#{langRequestId}, true)">
        <a4j:param name="val1" assignTo="#{langRequestId}"/>
      </a4j:jsFunction>

      <a4j:jsFunction name="declineRequest"
        action="#{languageJoinAction.declineRequest(langRequestId, comment)}"
        oncomplete="refreshRequestsSize();toggleActions(#{langRequestId}, false)">
        <a4j:param name="val1" assignTo="#{langRequestId}"/>
        <a4j:param name="val2" assignTo="#{comment}"/>
      </a4j:jsFunction>

      <ui:fragment rendered="#{languageAction.requests.isEmpty()}">
        <p class="txt--meta l--pad-all-half">#{msgs['jsf.language.request.empty']}</p>
      </ui:fragment>

      <ui:fragment rendered="#{not languageAction.requests.isEmpty()}">
        <ul class="list--stats">
          <ui:repeat value="#{languageAction.requests}" var="langRequest">
            <li class="l--pad-all-quarter">
              <div class="list__item__content">
                <div class="list__item__info">
                  <h3 class="list__title">
                    #{langRequest.request.requester.person.name}
                  </h3>
                  <span class="list__item__meta">
                    #{langRequest.request.requester.username} <span>[#{langRequest.request.requester.person.email}]</span>
                    <span class="bx--block l--push-top-quarter">
                      #{msgs.format('jsf.language.request.role', languageJoinAction.getRequestedRole(langRequest))}
                    </span>
                  </span>
                </div>
                <div class="list__item__actions button--group">
                  <div id="#{langRequest.id}-actions">
                    <input name="#{langRequest.id}"
                      id="#{langRequest.id}-accept"
                      type="radio"
                      onchange="acceptRequest(#{langRequest.id})"
                      class="form__item__input js-example__setter"
                      data-example=""/>
                    <label for="#{langRequest.id}-accept"
                      id="#{langRequest.id}-accept-label"
                      class="button button--success">
                      #{msgs['jsf.language.request.accept']}
                    </label>

                    <input name="#{langRequest.id}"
                      id="#{langRequest.id}-decline"
                      type="radio"
                      onchange="declineRequest(#{langRequest.id}, 'reject')"
                      class="form__item__input js-example__setter"
                      data-example=""/>
                    <label for="#{langRequest.id}-decline" id="#{langRequest.id}-decline-label"
                      class="button button--danger">#{msgs['jsf.language.request.decline']}</label>
                  </div>
                  <div id="#{langRequest.id}-actions-roles" class="is-hidden">
                    <ui:fragment rendered="#{identity.hasPermission(languageAction.locale, 'manage-language-team')}">
                      <ul class="list--horizontal txt--meta">
                          <li>
                            #{msgs['jsf.Translator']}
                            <h:selectBooleanCheckbox value="#{languageJoinAction.isTranslator(langRequest.request.requester.person)}" id="translator">
                              <a4j:ajax event="change" execute="@this"
                                listener="#{languageAction.saveTeamTranslator(member)}"/>
                            </h:selectBooleanCheckbox>
                          </li>
                          <li>
                            #{msgs['jsf.Reviewer']}
                            <h:selectBooleanCheckbox value="#{languageJoinAction.isReviewer(langRequest.request.requester.person)}" id="reviewer">
                              <a4j:ajax event="change" execute="@this"
                                listener="#{languageAction.saveTeamReviewer(member)}"/>
                            </h:selectBooleanCheckbox>
                          </li>
                          <li>
                            #{msgs['jsf.Coordinator']}
                            <h:selectBooleanCheckbox value="#{languageJoinAction.isCoordinator(langRequest.request.requester.person)}" id="coordinator">
                              <a4j:ajax event="change" execute="@this"
                                listener="#{languageAction.saveTeamCoordinator(member)}"/>
                            </h:selectBooleanCheckbox>
                          </li>
                      </ul>
                    </ui:fragment>
                  </div>
                </div>
              </div>
            </li>
          </ui:repeat>
        </ul>
      </ui:fragment>
    </h:form>
  </div>
</ui:composition>
