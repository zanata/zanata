<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:a4j="http://richfaces.org/a4j">

<h1 class="l--push-all-0">
  #{languageTeamAction.locale.retrieveDisplayName()}
</h1>

<div class="panel l--push-top-1">
  <div class="panel__header">
    <div class="panel__header__actions">
      <s:div rendered="#{identity.loggedIn}"
        styleClass="dropdown dropdown--header dropdown--small dropdown--right dropdown--inline js-dropdown"
        id="more-actions">
        <a class="dropdown__toggle js-dropdown__toggle" href="#"
          title="#{msgs['jsf.tooltip.MoreActions']}"><i
          class="i i--ellipsis"></i></a>
        <h:form id="more-action-form" styleClass="l--push-bottom-0">
          <ul class="dropdown__content js-dropdown__content" role="content"
            aria-labelledby="dropdownContent">
            <s:fragment rendered="#{not languageTeamAction.isUserInTeam() and s:hasRole('admin')}">
              <li>
                <a4j:commandLink id="Join" action="#{languageTeamAction.joinTribe}"
                  styleClass="i__item--right"
                  render="memberPanel, more-action-form, members-count"
                  value=" #{msgs['jsf.JoinLanguageTeam']}">
                  <i class="i i--plus i__item__icon"></i>
                  <s:conversationId name="id" value="#{languageTeamAction.language}"/>
                </a4j:commandLink>
              </li>
            </s:fragment>

            <s:fragment rendered="#{languageTeamAction.isUserInTeam()}">
              <li>
                <a4j:commandLink id="Leave" styleClass="txt--danger i__item--right"
                  action="#{languageTeamAction.leaveTribe}"
                  render="memberPanel, more-action-form, members-count"
                  value="#{msgs['jsf.LeaveLanguageTeam']}">
                  <i class="i i--remove i__item__icon"></i>
                  <s:conversationId name="id" value="#{languageTeamAction.language}"/>
                </a4j:commandLink>
              </li>
            </s:fragment>

            <s:fragment rendered="#{identity.loggedIn and not languageTeamAction.isUserInTeam()}">
              <li>
                <s:link value="#{msgs['jsf.RequestToJoinLanguageTeam']}"
                  view="/language/request_to_join_update_role.xhtml"
                  styleClass="i__item--right">
                  <f:param name="emailType" value="request_join_language"/>
                  <f:param name="id" value="#{languageTeamAction.language}"/>
                  <i class="i i--plus i__item__icon"></i>
                </s:link>
              </li>
            </s:fragment>

            <s:fragment rendered="#{identity.loggedIn and languageTeamAction.isUserInTeam() and !(s:hasPermission(languageTeamAction.locale, 'manage-language-team'))}">
              <li>
                <s:link  value="#{msgs['jsf.RequestUpdateRoleLanguageTeam']}"
                  view="/language/request_to_join_update_role.xhtml"
                  styleClass="i__item--right">
                  <f:param name="emailType" value="request_role_language"/>
                  <f:param name="id" value="#{languageTeamAction.language}"/>
                  <i class="i i--plus i__item__icon"></i>
                </s:link>
              </li>
            </s:fragment>

            <s:fragment rendered="#{identity.loggedIn}">
              <li>
                <a href="#" class="i__item--right"
                  data-toggle="modal" onclick="return false;"
                  data-target="#contactCoordinatorDialog">
                  #{msgs['jsf.contactLanguageTeamCoordinator']}
                  <i class="i i--plus i__item__icon"></i>
                </a>
              </li>
            </s:fragment>

            <s:fragment rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
              <li>
                <a id="addTeamMemberLink" href="#" class="i__item--right"
                  data-toggle="modal" onclick="return false;"
                  data-target="#searchUserDialog">
                  #{msgs['jsf.AddTeamMember']}
                  <i class="i i--plus i__item__icon"></i>
                </a>
              </li>
            </s:fragment>
          </ul>
        </h:form>
      </s:div>
    </div>
    <h2 class="panel__heading">
      #{languageTeamAction.locale.localeId}<s:span
      styleClass="txt--meta" id="members-count"> [#{languageTeamAction.locale.retrieveNativeName()}] <i
      class="i i--users" title="#{msgs['jsf.TeamMembers']}"></i> #{languageTeamAction.localeMembers.size}</s:span>
    </h2>
  </div>

  <h:form id="memberPanel" styleClass="l--push-bottom-0">
    <ul class="list--stats">
      <ui:repeat value="#{languageTeamAction.localeMembers}" var="member">
        <li class="list__item--actionable">
          <s:div styleClass="list__item__action" rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
            <div
              class="dropdown dropdown--small dropdown--inline dropdown--single list__item__dropdown js-dropdown">
              <a href="#" title="Options"
                class="dropdown__toggle js-dropdown__toggle txt--meta">
                <span class="is-invisible">Options</span>
              </a>
              <ul class="dropdown__content js-dropdown__content">
                <li>
                  <a4j:commandLink value="#{msgs['jsf.Remove']}"
                    action="#{languageTeamAction.removeMembership(member)}"
                    render="memberPanel, more-action-form, userAddPanel, members-count" execute="@this"
                    styleClass="i__item--right txt--danger">
                    <i class="i i--remove i__item__icon"></i>
                  </a4j:commandLink>
                </li>
              </ul>
            </div>
          </s:div>
          <div class="list__item__content">
            <div class="list__item__info">
              <div class="bx--inline-block w--3-5">
                <h3 class="list__title">
                  #{member.person.name}
                </h3>
                  <span class="list__item__meta">
                    #{member.person.account.username} [#{member.person.email}]
                  </span>
              </div>
              <div class="bx--inline-block txt--align-right">
                <ul class="list--horizontal txt--meta">
                  <li>
                    #{msgs['jsf.Translator']}
                    <h:selectBooleanCheckbox value="#{member.translator}"
                      rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <a4j:ajax event="change" execute="@this"
                        listener="#{languageTeamAction.saveTeamTranslator(member)}"/>
                    </h:selectBooleanCheckbox>
                    <s:fragment rendered="#{not s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <s:fragment rendered="#{member.translator}">
                        <i class="i i--checkmark"></i>
                      </s:fragment>
                      <s:fragment rendered="#{not member.translator}">
                        <i class="i i--cancel"></i>
                      </s:fragment>
                    </s:fragment>
                  </li>
                  <li>
                    #{msgs['jsf.Reviewer']}
                    <h:selectBooleanCheckbox value="#{member.reviewer}"
                      rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <a4j:ajax event="change" execute="@this"
                        listener="#{languageTeamAction.saveTeamReviewer(member)}"/>
                    </h:selectBooleanCheckbox>
                    <s:fragment rendered="#{not s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <s:fragment rendered="#{member.reviewer}">
                        <i class="i i--checkmark"></i>
                      </s:fragment>
                      <s:fragment rendered="#{not member.reviewer}">
                        <i class="i i--cancel"></i>
                      </s:fragment>
                    </s:fragment>
                  </li>

                  <li>
                    #{msgs['jsf.Coordinator']}
                    <h:selectBooleanCheckbox value="#{member.coordinator}"
                      rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <a4j:ajax event="change" execute="@this"
                        listener="#{languageTeamAction.saveTeamCoordinator(member)}"/>
                    </h:selectBooleanCheckbox>
                    <s:fragment rendered="#{not s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
                      <s:fragment rendered="#{member.coordinator}">
                        <i class="i i--checkmark"></i>
                      </s:fragment>
                      <s:fragment rendered="#{not member.coordinator}">
                        <i class="i i--cancel"></i>
                      </s:fragment>
                    </s:fragment>
                  </li>
                </ul>
              </div>
            </div>
            <div class="txt--align-right"></div>
          </div>
        </li>
      </ui:repeat>
    </ul>
  </h:form>
</div>

<s:fragment rendered="#{s:hasPermission(languageTeamAction.locale, 'manage-language-team')}">
  <ui:include src="search_user_modal.xhtml"/>
</s:fragment>

<s:fragment rendered="#{identity.loggedIn}">
  <ui:include src="contact_coodinator_modal.xhtml">
    <ui:param name="emailType" value="contact_coordinator" />
    <ui:param name="id" value="#{languageTeamAction.language}" />
  </ui:include>
</s:fragment>

</ui:composition>
