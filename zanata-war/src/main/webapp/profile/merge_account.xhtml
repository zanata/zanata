<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  template="../WEB-INF/template/template.xhtml">

  <ui:define
    name="page_title">#{messages['jsf.profile.MergeAccount']}
  </ui:define>

  <ui:define name="head">
    <!-- Load jQuery -->
    <!--<rich:jQuery query="jquery"/>-->

    <script type="text/javascript">
      function updateLoginType(selectedElement, showUsername,
                               usernameLabel, showPassword) {
        jQuery(selectedElement).parent().siblings("li").children("a").removeClass('is-active');

        jQuery('.js--provider--dropdown').children('span').attr('class', jQuery(selectedElement).attr('class'));
        jQuery('.js--provider--dropdown').children('span').html(jQuery(selectedElement).html());

        jQuery(selectedElement).addClass('is-active');
        jQuery('.js--provider--dropdown').parent().removeClass('is-active');

        var fieldSelector = "[id='#{rich:clientId('login_provider')}']";
        jQuery(fieldSelector).val(jQuery(selectedElement).attr('name'));

        var usernamefieldSelector = "#providerUsernameField";
        if (showUsername) {
          jQuery("[id='#{rich:clientId('identityLabel')}']").html(usernameLabel);
          jQuery(usernamefieldSelector).removeClass("is-hidden");
        }
        else {
          jQuery(usernamefieldSelector).addClass("is-hidden");
        }

        var passwordfieldSelector = "#providerPasswordField";
        if (showPassword) {
          jQuery(passwordfieldSelector).removeClass("is-hidden");
        }
        else {
          jQuery(passwordfieldSelector).addClass("is-hidden");
        }
        jQuery("[id='#{rich:clientId('verifyButton')}']").show();
      }
    </script>

  </ui:define>

  <ui:define name="center_content">
    <div class="g--centered">
      <div class="g__item w--1-2-m w--3-8-l w--1-3 l--push-bottom-1">

        <p class="txt--meta l--push-all-0">
          <a href="#{request.contextPath}/dashboard/settings/account"
            onclick="changeBrowserUrl(this.href, true);">
            #{messages['jsf.Dashboard']}
          </a>
        </p>

        <h1 class="l--push-all-0">#{messages['jsf.profile.MergeAccount']}</h1>

        <h:form
          rendered="#{not accountMergeAction.accountSelected or not accountMergeAction.accountsValid}"
          styleClass="l--push-top-1">
          <p>
            <h:outputText
              value="#{messages['jsf.profile.MergeAccount.info']}"/>
          </p>

          <span class="dropdown dropdown--toggle-right js-dropdown">
            <a class="dropdown__toggle dropdown__toggle--large js-dropdown__toggle js--provider--dropdown" href="#">
              <span>#{messages['jsf.account.merge.select.label']}</span>
            </a>
            <ul class="dropdown__content js-dropdown__content">
              <li>
                <a class="list__item--fedora" href="#" name="Fedora"
                  onclick="updateLoginType(this, true, '#{messages['jsf.login.openid.fedora']}')">
                  Fedora
                </a>
              </li>
              <li>
                <a href="#" class="list__item--google" name="Google"
                  onclick="updateLoginType(this, false)">
                  Google
                </a>
              </li>
              <li>
                <a href="#" class="list__item--yahoo" name="Yahoo"
                  onclick="updateLoginType(this, true, '#{messages['jsf.login.openid.yahoo']}')">
                  Yahoo
                </a>
              </li>
              <li>
                <a href="#" class="list__item--openid" name="Generic"
                  onclick="updateLoginType(this, true, '#{messages['jsf.login.openid']}')">
                  OpenId
                </a>
              </li>
              <li>
                <a href="#" class="list__item--zanata" name="INTERNAL"
                  onclick="updateLoginType(this, true, '#{messages['jsf.login.internal']}', true)">
                  Zanata
                </a>
              </li>
            </ul>
          </span>

          <h:inputHidden id="login_provider"
            value="${accountMergeAction.providerType}"/>

          <div class="l--push-top-half form__item is-hidden"
            id="providerUsernameField">
            <h:outputLabel id="identityLabel" for="username">
              #{messages['jsf.FedoraUsername']}
            </h:outputLabel>
            <s:decorate template="../WEB-INF/layout/field.xhtml"
              enclose="true">
              <h:inputText id="username"
                value="#{accountMergeAction.username}"/>
            </s:decorate>
          </div>

          <div class="l--push-top-half form__item is-hidden"
            id="providerPasswordField">
            <h:outputLabel id="passwordLabel" for="password">
              #{messages['jsf.Password']}
            </h:outputLabel>
            <s:decorate template="../WEB-INF/layout/field.xhtml"
              enclose="true">
              <h:inputSecret id="password" value="#{loginAction.password}"/>
            </s:decorate>
          </div>

          <div class="l--push-top-1">
            <h:commandButton id="verifyButton"
              styleClass="button--primary button--full"
              value="#{messages['jsf.identities.Verify']}"
              action="#{accountMergeAction.loginToMergingAccount}"
              style="display:none"/>
          </div>
        </h:form>

        <h:form
          rendered="#{accountMergeAction.accountSelected and accountMergeAction.accountsValid}">
          <div class="content_box">
            <p>
              <h:outputText escape="false"
                value="#{messages['jsf.profile.MergeAccount.confirmationMessage']}"/>
            </p>
          </div>
          <h:commandButton
            value="#{messages['jsf.profile.MergeAccount.confirm']}"
            action="#{accountMergeAction.mergeAccounts}"/>
          <h:commandButton value="#{messages['jsf.Cancel']}"
            action="#{accountMergeAction.cancel}"/>
        </h:form>
      </div>
    </div>
  </ui:define>
</ui:composition>
