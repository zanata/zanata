<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  template="../WEB-INF/template/template.xhtml">

  <ui:define
    name="page_title">#{messages['jsf.profile.MergeAccount']}
  </ui:define>

  <ui:define name="head">
    <!-- Load jQuery -->
    <rich:jQuery query="jquery"/>

    <script type="text/javascript">
      function updateLoginType(selectedElement, type, showUsername,
                               usernameLabel, showPassword) {
        jQuery(".selected_login_option").each(function () {
          jQuery(this).removeClass('selected_login_option')
        });
        jQuery(selectedElement).addClass('selected_login_option');

        var fieldSelector = "[id='#{rich:clientId('login_provider')}']";
        jQuery(fieldSelector).val(type);

        var usernamefieldSelector = "#providerUsernameField";
        if (showUsername) {
          jQuery("[id='#{rich:clientId('identityLabel')}']").html(usernameLabel);
          jQuery(usernamefieldSelector).removeClass("is-hidden");
        }
        else {
          jQuery(usernamefieldSelector).addClass("is-hidden");
        }

        var passwordfieldSelector = "#providerPasswordField";
        if (showPassword) {
          jQuery(passwordfieldSelector).removeClass("is-hidden");
        }
        else {
          jQuery(passwordfieldSelector).addClass("is-hidden");
        }
        jQuery("[id='#{rich:clientId('verifyButton')}']").show();
      }
    </script>
  </ui:define>

  <ui:define name="center_content">
    <div class="g--centered">
      <div class="g__item w--1-2-m w--3-8-l w--1-3 l--push-bottom-1">

        <p class="txt--meta l--push-all-0">
          <a href="#{request.contextPath}/dashboard/settings/account"
            onclick="changeBrowserUrl(this.href, true);">
            #{messages['jsf.Dashboard']}
          </a>
        </p>

        <h1 class="l--push-all-0">#{messages['jsf.profile.MergeAccount']}</h1>

        <h:form
          rendered="#{not accountMergeAction.accountSelected or not accountMergeAction.accountsValid}"
          styleClass="l--push-top-1">
          <p>
            <h:outputText
              value="#{messages['jsf.profile.MergeAccount.info']}"/>
          </p>>
          <br/>
          <br/>
          <ui:remove>
            <!-- TODO use localizable strings for tooltips. -->
          </ui:remove>
          <ul class="list--horizontal">
            <li>
              <h:graphicImage id="fedora_signin"
                value="../images/openid/fedora.png"
                styleClass="login_option" title="Fedora" height="40" width="40"
                onclick="updateLoginType(this, 'Fedora', true, '#{messages['jsf.login.openid.fedora']}')"/>
            </li>
            <li>
              <h:graphicImage id="google_signin"
                value="../images/openid/google.png"
                styleClass="login_option" title="Google" height="40" width="40"
                onclick="updateLoginType(this, 'Google', false)"/>
            </li>
            <li>
              <h:graphicImage id="myopenid_signin"
                value="../images/openid/myopenid.png"
                styleClass="login_option" title="MyOpenID" height="40"
                width="40"
                onclick="updateLoginType(this, 'MyOpenId', true, '#{messages['jsf.login.openid.myopenid']}')"/>
            </li>
            <li>
              <h:graphicImage id="yahoo_signin"
                value="../images/openid/yahoo.png"
                styleClass="login_option" title="Yahoo" height="40" width="40"
                onclick="updateLoginType(this, 'Yahoo', true, '#{messages['jsf.login.openid.yahoo']}')"/>
            </li>
            <li>
              <h:graphicImage id="openid_signin"
                value="../images/openid/openid.png"
                styleClass="login_option" title="Open ID" height="40" width="40"
                onclick="updateLoginType(this, 'Generic', true, '#{messages['jsf.login.openid']}')"/>
            </li>
            <li>
              <img id="internal_signin"
                src="#{applicationConfiguration.webAssetsUrl}/logo.svg"
                class="login_option" title="Zanata" height="40" width="40"
                onclick="updateLoginType(this, 'INTERNAL', true, '#{messages['jsf.login.internal']}', true)"/>
            </li>
          </ul>

          <h:inputHidden id="login_provider"
            value="${accountMergeAction.providerType}"/>

          <div class="l--push-top-half form__item is-hidden"
            id="providerUsernameField">
            <h:outputLabel id="identityLabel" for="username">
              #{messages['jsf.FedoraUsername']}
            </h:outputLabel>
            <s:decorate template="../WEB-INF/layout/field.xhtml"
              enclose="true">
              <h:inputText id="username"
                value="#{accountMergeAction.username}"/>
            </s:decorate>
          </div>

          <div class="l--push-top-half form__item is-hidden"
            id="providerPasswordField">
            <h:outputLabel id="passwordLabel" for="password">
              #{messages['jsf.Password']}
            </h:outputLabel>
            <s:decorate template="../WEB-INF/layout/field.xhtml"
              enclose="true">
              <h:inputSecret id="password" value="#{loginAction.password}"/>
            </s:decorate>
          </div>

          <div class="l--push-top-1">
            <h:commandButton id="verifyButton"
              styleClass="button--primary button--full"
              value="#{messages['jsf.identities.Verify']}"
              action="#{accountMergeAction.loginToMergingAccount}"
              style="display:none"/>
          </div>
        </h:form>

        <h:form
          rendered="#{accountMergeAction.accountSelected and accountMergeAction.accountsValid}">
          <div class="content_box">
            <p>
              <h:outputText escape="false"
                value="#{messages['jsf.profile.MergeAccount.confirmationMessage']}"/>
            </p>
          </div>
          <h:commandButton
            value="#{messages['jsf.profile.MergeAccount.confirm']}"
            action="#{accountMergeAction.mergeAccounts}"/>
          <h:commandButton value="#{messages['jsf.Cancel']}"
            action="#{accountMergeAction.cancel}"/>
        </h:form>
      </div>
    </div>
  </ui:define>

</ui:composition>
