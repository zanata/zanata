!function(){"use strict";angular.module("app",["ngResource","ngAnimate","ui.router","templates","cfp.hotkeys","focusOn","monospaced.elastic","gettext","diff-match-patch"])}(),function(){"use strict";function t(t,e,n,o){var r=function(t,e){return{request:function(t){return e.$broadcast("loadingStart"),t},requestError:function(n){return e.$broadcast("loadingStop"),console.error("Request error due to ",n),t.reject(n)},response:function(n){return e.$broadcast("loadingStop"),n||t.when(n)},responseError:function(n){return e.$broadcast("loadingStop"),401===n.status?console.error("Unauthorized access. Please login"):404===n.status?console.error("Service end point not found- ",n.config.url):console.error("Error in response ",n),t.reject(n)}}};r.$inject=["$q","$rootScope"],n.interceptors.push(r),e.otherwise("/"),t.state("editor",{url:"/:projectSlug/:versionSlug/translate",templateUrl:"editor/editor.html",controller:"EditorCtrl as editor",resolve:{url:["UrlService",function(t){return t.init()}]}}).state("editor.selectedContext",{url:"/:docId/:localeId",views:{"editor-content":{templateUrl:"editor/editor-content.html",controller:"EditorContentCtrl as editorContent"},"editor-suggestions":{templateUrl:"editor/editor-suggestions.html",controller:"EditorSuggestionsCtrl as editorSuggestions"},"editor-details":{templateUrl:"editor/editor-details.html",controller:"EditorDetailsCtrl as editorDetails"}}}).state("editor.selectedContext.tu",{url:"/?id&selected?states",reloadOnSearch:!1}),o.includeCheatSheet=!1}t.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","hotkeysProvider"],angular.module("app").config(t)}(),function(){"use strict";angular.module("app").constant("_",window._).constant("str",window._.string).constant("Mousetrap",window.Mousetrap).constant("PRODUCTION",!0)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s){function c(){return o.getAllLocales()}function u(){return e.getMyInfo().then(function(t){d.myInfo=t,d.myInfo.locale=o.DEFAULT_LOCALE,d.myInfo.gravatarUrl=n.gravatarUrl(d.myInfo.gravatarHash,72)},function(t){r.displayError("Error loading my info: "+t)})}function l(){o.getUILocaleList().then(function(t){for(var e in t.locales){var n={localeId:t.locales[e],name:""};d.uiLocaleList.push(n)}d.myInfo.locale=o.getLocaleByLocaleId(d.uiLocaleList,o.DEFAULT_LOCALE.localeId),d.myInfo.locale||(d.myInfo.locale=o.DEFAULT_LOCALE)},function(t){r.displayInfo("Error loading UI locale. Default to '"+o.DEFAULT_LOCALE.name+"': "+t),d.myInfo.locale=o.DEFAULT_LOCALE})}var d=this;d.PRODUCTION=s,d.settings=e.settings,d.uiLocaleList=[o.DEFAULT_LOCALE],n.init().then(c).then(u).then(l),d.onChangeUILocale=function(t){d.myInfo.locale=t;var e=d.myInfo.locale.localeId;a.startsWith(e,o.DEFAULT_LOCALE.localeId,!0)?i.setCurrentLanguage(o.DEFAULT_LOCALE.localeId):i.loadRemote(n.uiTranslationURL(e)).then(function(){i.setCurrentLanguage(e)},function(t){r.displayInfo("Error loading UI locale. Default to '"+o.DEFAULT_LOCALE.name+"': "+t),i.setCurrentLanguage(o.DEFAULT_LOCALE),d.myInfo.locale=o.DEFAULT_LOCALE})},d.dashboardPage=function(){return n.DASHBOARD_PAGE}}t.$inject=["$scope","UserService","UrlService","LocaleService","MessageHandler","gettextCatalog","StringUtil","PRODUCTION"],angular.module("app").controller("AppCtrl",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c,u,l){function d(){v=r.readValue("status"),u.isUndefined(v)||(v=v.split(","),v=u.transform(v,function(t,e){return e=l.getServerId(e),t.push(e)})),I={status:v}}function f(t,e){var n,o,r,c,l=N.phrases;o=u.findIndex(l,function(t){return t.id===e.currentId}),r=Math.min(o+1,l.length-1),c=l[r].id,c!==e.currentId?i.emitEvent(i.EVENT.SELECT_TRANS_UNIT,{id:c,updateURL:!0,focus:!0},null):(n=l[o],i.emitEvent(i.EVENT.SAVE_TRANSLATION,{phrase:n,status:s.getSaveButtonStatus(n),locale:a.localeId,docId:a.docId}))}function S(t,e){var n,o,r,c,l=N.phrases;o=u.findIndex(l,function(t){return t.id===e.currentId}),r=Math.max(o-1,0),c=l[r].id,c!==e.currentId?i.emitEvent(i.EVENT.SELECT_TRANS_UNIT,{id:c,updateURL:!0,focus:!0},null):(n=l[o],i.emitEvent(i.EVENT.SAVE_TRANSLATION,{phrase:n,status:s.getSaveButtonStatus(n),locale:a.localeId,docId:a.docId}))}function g(t,e){var n,o,r=N.phrases,a=l.getStatusInfo(v);n=u.findIndex(r,function(t){return t.id===e.currentId});for(var s=n+1;s<r.length;s++)if(o=l.getStatusInfo(r[s].state),o.ID===a.ID)return void i.emitEvent(i.EVENT.SELECT_TRANS_UNIT,{id:r[s].id,updateURL:!0,focus:!0},null)}function E(t){T(t),i.emitEvent(i.EVENT.CANCEL_EDIT)}function p(){i.emitEvent(i.EVENT.REFRESH_STATISTIC,{projectSlug:e.context.projectSlug,versionSlug:e.context.versionSlug,docId:e.context.docId,localeId:e.context.localeId}),n.getPhraseCount(e.context,I).then(function(t){e.maxPageIndex=parseInt(t/m),t>m&&(e.maxPageIndex=t%m!==0?e.maxPageIndex+=1:e.maxPageIndex),e.maxPageIndex=e.maxPageIndex-1<0?0:e.maxPageIndex-1,T(e.currentPageIndex)})}function T(t){var o=t*m;n.fetchAllPhrase(e.context,I,o,m).then(h)}function h(t){N.phrases=t}var v,I,m=50,N=this;return d(),N.phrases=[],e.updateContext(a.projectSlug,a.versionSlug,o.decodeDocId(a.docId),a.localeId),p(),t.$on(i.EVENT.FILTER_TRANS_UNIT,function(t,e){if(e.status.all===!0)c.search("status",null);else{var n=[];u.forEach(e.status,function(t,e){t&&n.push(e)}),c.search("status",n.join(","))}d(),p()}),t.$on(i.EVENT.GOTO_FIRST_PAGE,function(){e.currentPageIndex>0&&(e.currentPageIndex=0,E(e.currentPageIndex))}),t.$on(i.EVENT.GOTO_PREV_PAGE,function(){e.currentPageIndex>0&&(e.currentPageIndex-=1,E(e.currentPageIndex))}),t.$on(i.EVENT.GOTO_NEXT_PAGE,function(){e.currentPageIndex<e.maxPageIndex&&(e.currentPageIndex+=1,E(e.currentPageIndex))}),t.$on(i.EVENT.GOTO_LAST_PAGE,function(){e.currentPageIndex<e.maxPageIndex&&(e.currentPageIndex=e.maxPageIndex,E(e.currentPageIndex))}),t.$on(i.EVENT.GOTO_NEXT_ROW,f),t.$on(i.EVENT.GOTO_PREVIOUS_ROW,S),t.$on(i.EVENT.GOTO_NEXT_UNTRANSLATED,g),N}t.$inject=["$rootScope","EditorService","PhraseService","DocumentService","UrlService","EventService","$stateParams","PhraseUtil","$location","_","TransStatusService"],angular.module("app").controller("EditorContentCtrl",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c,u,l,d,f,S,g,E,p){function T(){var t=c.readValue("status");E.isUndefined(t)||(t=t.split(","),E.forEach(t,function(t){E.isUndefined(A.filter.status[t])||(A.filter.status[t]=!0)}),v())}function h(t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable}function v(t){m(A.filter.status)?I(t):(A.filter.status.all=!1,t&&S.emitEvent(S.EVENT.FILTER_TRANS_UNIT,A.filter))}function I(t){A.filter.status.all=!0,A.filter.status.approved=!1,A.filter.status.translated=!1,A.filter.status.needsWork=!1,A.filter.status.untranslated=!1,t&&S.emitEvent(S.EVENT.FILTER_TRANS_UNIT,A.filter)}function m(t){return t.approved===t.translated&&t.translated===t.needsWork&&t.needsWork===t.untranslated}function N(){O()&&l.go("editor.selectedContext",{docId:A.context.docId,localeId:A.context.localeId})}function O(){return A.context.docId&&A.context.localeId}function _(t,e,o,r){n.getStatistics(t,e,o,r).then(function(t){A.wordStatistic=s.getWordStatistic(t),A.messageStatistic=s.getMsgStatistic(t)},function(t){d.displayError("Error loading statistic: "+t)})}var A=this;A.pageNumber=1,A.showCheatsheet=!1,A.shortcuts=E.mapValues(E.values(g.SHORTCUTS),function(t){var e=E.flatten(t.keyCombos,"combo");return{combos:E.map(e,function(t){return g.symbolizeKey(t)}),description:t.keyCombos[0].description}}),A.filter={status:{all:!0,approved:!1,translated:!1,needsWork:!1,untranslated:!1}},T(),p.bind("?",function(e){var n=e.srcElement;A.showCheatsheet||h(n)||(A.toggleKeyboardShortcutsModal(),t.$digest())},"keyup"),A.context=i.initContext(u.projectSlug,u.versionSlug,n.decodeDocId(u.docId),o.DEFAULT_LOCALE,o.DEFAULT_LOCALE.localeId,"READ_WRITE"),A.toggleKeyboardShortcutsModal=function(){A.showCheatsheet=!A.showCheatsheet};var C=a.SETTING.SHOW_SUGGESTIONS;t.showSuggestions=a.subscribe(C,function(e){t.showSuggestions=e}),A.toggleSuggestionPanel=function(){a.update(C,!t.showSuggestions)},A.versionPage=function(){return c.PROJECT_PAGE(A.context.projectSlug,A.context.versionSlug)},A.encodeDocId=function(t){return n.encodeDocId(t)},r.getProjectInfo(u.projectSlug).then(function(t){A.projectInfo=t},function(t){d.displayError("Error getting project information:"+t)}),o.getSupportedLocales(A.context.projectSlug,A.context.versionSlug).then(function(t){if(A.locales=t,!A.locales||A.locales.length<=0)d.displayError("No supported locales in "+A.context.projectSlug+" : "+A.context.versionSlug);else{var e=l.params.localeId,n=A.context;e?(n.localeId=e,o.containsLocale(A.locales,e)||(n.localeId=A.locales[0].localeId)):(n.localeId=A.locales[0].localeId,N())}},function(t){d.displayError("Error getting locale list: "+t)}),n.findAll(A.context.projectSlug,A.context.versionSlug).then(function(t){if(A.documents=t,!A.documents||A.documents.length<=0)d.displayError("No documents in "+A.context.projectSlug+" : "+A.context.versionSlug);else{var e=l.params.docId,o=A.context;e?(o.docId=n.decodeDocId(e),n.containsDoc(A.documents,o.docId)||(o.docId=A.documents[0].name)):(o.docId=A.documents[0].name,N())}},function(t){d.displayError("Error getting document list: "+t)}),f.$on(S.EVENT.SELECT_TRANS_UNIT,function(t,e){A.unitSelected=e.id,A.focused=e.focus}),f.$on(S.EVENT.CANCEL_EDIT,function(){A.unitSelected=!1,A.focused=!1}),f.$on(S.EVENT.REFRESH_STATISTIC,function(t,e){_(e.projectSlug,e.versionSlug,e.docId,e.localeId),A.context.docId=e.docId,A.context.localeId=e.localeId}),A.pageNumber=function(){return 0===i.maxPageIndex?i.currentPageIndex+1:i.currentPageIndex+1+" of "+(i.maxPageIndex+1)},A.getLocaleName=function(t){return o.getName(t)},A.firstPage=function(){S.emitEvent(S.EVENT.GOTO_FIRST_PAGE)},A.lastPage=function(){S.emitEvent(S.EVENT.GOTO_LAST_PAGE)},A.nextPage=function(){S.emitEvent(S.EVENT.GOTO_NEXT_PAGE)},A.previousPage=function(){S.emitEvent(S.EVENT.GOTO_PREV_PAGE)},A.resetFilter=function(){I(!0)},A.updateFilter=function(){v(!0)},this.settings=e.settings.editor,g.enableEditorKeys()}t.$inject=["$scope","UserService","DocumentService","LocaleService","ProjectService","EditorService","SettingsService","StatisticUtil","UrlService","$stateParams","$state","MessageHandler","$rootScope","EventService","EditorShortcuts","_","Mousetrap"],angular.module("app").controller("EditorCtrl",t)}(),function(){"use strict";function t(){var t=this;return t}angular.module("app").controller("EditorDetailsCtrl",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c,u){function l(t,e){return a.hasTranslationChanged(t)||t.status!==e}function d(t){var a=n.cloneDeep(S.context),l=g[t],d=e(o.TRANSLATION_URL,{},{update:{method:"PUT",params:{localeId:l.locale}}}),f={id:l.phrase.id,revision:l.phrase.revision||0,content:l.phrase.newTranslations[0],contents:l.phrase.newTranslations,status:u.getServerId(l.status.ID),plural:l.phrase.plural};d.update(f).$promise.then(function(t){var e=l.phrase.status.ID;i.onTransUnitUpdated(a,f.id,l.locale,t.revision,t.status,l.phrase),s.updateStatistic(a.projectSlug,a.versionSlug,l.docId,l.locale,e,u.getId(t.status),l.phrase.wordCount),r.emitEvent(r.EVENT.SAVE_COMPLETED,l.phrase)},function(t){c.displayWarning("Update translation failed for "+f.id+" -"+t),i.onTransUnitUpdateFailed(f.id),r.emitEvent(r.EVENT.SAVE_COMPLETED,l.phrase)}),delete g[t]}function f(t,e){return n.isEmpty(n.compact(t.newTranslations))?u.getStatusInfo("UNTRANSLATED"):e}var S=this,g={};return S.context={},S.currentPageIndex=0,S.maxPageIndex=0,S.initContext=function(t,e,n,o,r,i){return S.context={projectSlug:t,versionSlug:e,docId:n,srcLocale:o,localeId:r,mode:i},S.context},S.updateContext=function(t,e,n,o){S.context.projectSlug!==t&&(S.context.projectSlug=t),S.context.versionSlug!==e&&(S.context.versionSlug=e),S.context.docId!==n&&(S.context.docId=n),S.context.localeId!==o&&(S.context.localeId=o)},t.$on(r.EVENT.SAVE_TRANSLATION,function(t,e){var o=e.phrase,i=e.status;if(l(o,i)){if(n.has(g,o.id)){var a=g[o.id];a.phrase=o,a.status=i}else i=f(o,i),g[o.id]={phrase:o,status:i,locale:e.locale,docId:e.docId};r.emitEvent(r.EVENT.SAVE_INITIATED,e),d(o.id)}}),S}t.$inject=["$rootScope","$resource","_","UrlService","EventService","PhraseService","PhraseUtil","DocumentService","MessageHandler","TransStatusService"],angular.module("app").factory("EditorService",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c){function u(e){m.selectedTUCtrl&&(e.preventDefault(),t.emitEvent(t.EVENT.COPY_FROM_SOURCE,{phrase:m.selectedTUCtrl.getPhrase()}))}function l(e){m.selectedTUCtrl&&(e.preventDefault(),e.stopPropagation(),t.emitEvent(t.EVENT.GOTO_NEXT_ROW,v()))}function d(e){m.selectedTUCtrl&&(e.preventDefault(),e.stopPropagation(),t.emitEvent(t.EVENT.GOTO_PREVIOUS_ROW,v()))}function f(e){if(e.preventDefault(),e.stopPropagation(),N)m.cancelSaveAsModeIfOn(),m.selectedTUCtrl&&m.selectedTUCtrl.focusTranslation();else if(m.selectedTUCtrl){var n=m.selectedTUCtrl.getPhrase();r.hasTranslationChanged(n)?t.emitEvent(t.EVENT.UNDO_EDIT,n):t.emitEvent(t.EVENT.CANCEL_EDIT,n)}}function S(n){if(m.selectedTUCtrl){n.preventDefault();var o=m.selectedTUCtrl.getPhrase();t.emitEvent(t.EVENT.SAVE_TRANSLATION,{phrase:o,status:r.getSaveButtonStatus(o),locale:e.localeId,docId:e.docId})}}function g(e){e.preventDefault(),m.cancelSaveAsModeIfOn();var n=m.selectedTUCtrl.getPhrase();n&&(t.emitEvent(t.EVENT.TOGGLE_SAVE_OPTIONS,{id:n.id,open:!0}),I(n,"n","needsWork"),I(n,"t","translated"),I(n,"a","approved"))}function E(e){return function(n){n.preventDefault(),t.emitEvent(t.EVENT.COPY_FROM_SUGGESTION_N,e-1)}}function p(t,e,n,o,r){return this.defaultKey=t,this.keyCombos=[T(t,n,r,e)],o&&(this.otherKeys=o instanceof Array?o:[o],this.keyCombos.push(T(this.otherKeys,"",r,e))),this}function T(t,e,n,o){var r={allowIn:["TEXTAREA"],callback:o};return r.combo=t,e&&(r.description=e),n&&(r.action=n),r}function h(t){o.get(t.defaultKey)||n.forEach(t.keyCombos,function(t){o.add(t)})}function v(){return{currentId:m.selectedTUCtrl.getPhrase().id}}function I(t,e,n){var r=i.getStatusInfo(n);return o.add({combo:e,description:s.sprintf("Save as %s",n),allowIn:["INPUT","TEXTAREA"],action:"keydown",callback:function(e){m.saveTranslationCallBack(e,t,r)}})}var m=this,N=!1;return m.selectedTUCtrl=null,m.SHORTCUTS={COPY_SOURCE:new p("alt+c",u,"Copy source as translation","alt+g"),COPY_SUGGESTION_1:new p("mod+alt+1",E(1),"Copy first suggestion as translation"),COPY_SUGGESTION_2:new p("mod+alt+2",E(2),"Copy second suggestion as translation"),COPY_SUGGESTION_3:new p("mod+alt+3",E(3),"Copy third suggestion as translation"),COPY_SUGGESTION_4:new p("mod+alt+4",E(4),"Copy fourth suggestion as translation"),CANCEL_EDIT:new p("esc",f,"Cancel edit"),SAVE_AS_CURRENT_BUTTON_OPTION:new p("mod+s",S,"Save"),SAVE_AS_MODE:new p("mod+shift+s",g,"Save as…"),SAVE_AS_NEEDSWORK:{keyCombos:[{combo:"mod+shift+s n",description:"Save as needs work"}]},SAVE_AS_TRANSLATED:{keyCombos:[{combo:"mod+shift+s t",description:"Save as translated"}]},SAVE_AS_APPROVED:{keyCombos:[{combo:"mod+shift+s a",description:"Save as approved"}]},GOTO_NEXT_ROW_FAST:new p("mod+enter",l,"Save (if changed) and go to next string",["alt+k","alt+down"]),GOTO_PREVIOUS_ROW:new p("mod+shift+enter",d,"Save (if changed) and go to previous string",["alt+j","alt+up"])},m.enableEditorKeys=function(){o.get(m.SHORTCUTS.COPY_SOURCE.defaultKey)||n.forOwn(m.SHORTCUTS,function(t){t instanceof p&&h(t)})},m.disableEditorKeys=function(){n.forOwn(m.SHORTCUTS,function(t){n.forEach(t.keyCombos,function(t){m.deleteKeys(t.combo,t.action)})})},m.saveTranslationCallBack=function(n,o,r){N=!0,n.preventDefault(),n.stopPropagation(),t.emitEvent(t.EVENT.SAVE_TRANSLATION,{phrase:o,status:r,locale:e.localeId,docId:e.docId}),m.cancelSaveAsModeIfOn()},m.cancelSaveAsModeIfOn=function(){N&&m.selectedTUCtrl&&(N=!1,m.deleteKeys(["n","t","a"]),t.emitEvent(t.EVENT.TOGGLE_SAVE_OPTIONS,{id:m.selectedTUCtrl.getPhrase().id,open:!1}))},m.deleteKeys=function(t,e){var r=t instanceof Array?t:[t];e=e||"keydown",n.forEach(r,function(t){o.del(t),a.unbind(t,e)})},m.symbolizeKey=function(t){var e={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};t=t.split("+");for(var n=0;n<t.length;n++)"mod"===t[n]&&(t[n]=c.navigator&&c.navigator.platform.indexOf("Mac")>=0?"command":"ctrl"),t[n]=e[t[n]]||t[n];return t.join(" + ")},m}t.$inject=["EventService","$stateParams","_","hotkeys","PhraseUtil","TransStatusService","Mousetrap","str","$window"],angular.module("app").factory("EditorShortcuts",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c){function u(e){t.isTextSearch=e,t.isPhraseSearch=!e}function l(e){t.suggestions=e}function d(){t.search.isVisible=!1,u(!1),S()}function f(e,n){t.search.input.text="",t.search.isVisible=!0,!n&&e&&t.focusSearch(e),h.searchForText(),g()}function S(){t.searchStrings=o.getSearchStrings(),t.search.isLoading=o.isLoading(),l(o.getResults())}function g(){t.searchStrings=r.getSearchStrings(),t.search.isLoading=r.isLoading(),l(r.getResults())}function E(t){t&&i.emitEvent(i.EVENT.COPY_FROM_SUGGESTION,{suggestion:t})}var p=n.SETTING.SHOW_SUGGESTIONS,T=n.SETTING.SUGGESTIONS_SHOW_DIFFERENCE,h=this;return t.suggestions=[],t.hasSuggestions=!1,t.$watch("suggestions.length",function(e){t.hasSuggestions=0!==e}),t.searchStrings=[],t.hasSearch=!1,t.$watch("searchStrings.length",function(e){t.hasSearch=0!==e}),t.isTransUnitSelected=!1,t.isTextSearch=!1,t.isPhraseSearch=!0,t.search={isVisible:!1,isLoading:!1,input:{text:"",focused:!1}},t.$watch("search.input.text",function(){h.searchForText()}),t.show=n.subscribe(p,function(e){t.show=e,e&&(t.isTransUnitSelected?S():t.search.isVisible||f(null,!0))}),t.diff=n.subscribe(T,function(e){t.diff=e}),t.focusSearch=function(t){t&&t.preventDefault(),c("searchSugInput")},h.closeSuggestions=function(){n.update(p,!1),i.emitEvent(i.EVENT.SUGGESTIONS_SEARCH_TOGGLE,!1)},h.clearSearchResults=function(e,n){t.search.input.text="",!n&&e&&t.focusSearch(e)},h.searchForText=function(){var e=t.search.input.text;e.length>0&&(t.search.isLoading=!0),u(!0),i.emitEvent(i.EVENT.REQUEST_TEXT_SUGGESTIONS,e)},h.toggleSearch=function(){t.search.isVisible?i.emitEvent(i.EVENT.SUGGESTIONS_SEARCH_TOGGLE,!1):i.emitEvent(i.EVENT.SUGGESTIONS_SEARCH_TOGGLE,!0)},t.show&&!t.isTransUnitSelected&&f(),a.$on(i.EVENT.SELECT_TRANS_UNIT,function(){""===t.search.input.text&&t.search.isVisible&&i.emitEvent(i.EVENT.SUGGESTIONS_SEARCH_TOGGLE,!1),t.isTransUnitSelected=!0}),a.$on(i.EVENT.CANCEL_EDIT,function(){t.isTransUnitSelected=!1,t.show&&!t.search.isVisible&&f(null,!0)}),a.$on(i.EVENT.SUGGESTIONS_SEARCH_TOGGLE,function(t,e){e?f(t):d(t)}),a.$on("PhraseSuggestionsService:updated",function(){t.isPhraseSearch&&S()}),a.$on("TextSuggestionsService:updated",function(){t.isTextSearch&&g()}),a.$on(i.EVENT.COPY_FROM_SUGGESTION_N,function(e,n){t.show?(E(t.suggestions[n]),t.$broadcast("EditorSuggestionsCtrl:nth-suggestion-copied",n)):E(o.getResults()[n])}),h}t.$inject=["$scope","_","SettingsService","PhraseSuggestionsService","TextSuggestionsService","EventService","$rootScope","$timeout","focus"],angular.module("app").controller("EditorSuggestionsCtrl",t)}(),function(){"use strict";function t(){return{restrict:"A",link:function(t,e,n){return t.$on("blurOn",function(t,o){return o===n.blurOn?e[0].blur():void 0})}}}angular.module("app").directive("blurOn",t)}(),function(){"use strict";function t(t){return{restrict:"A",scope:{callback:"&clickElsewhere"},link:function(e,n){var o=function(t){n[0].contains(t.target)||e.$apply(e.callback(t))};t.on("click",o),e.$on("$destroy",function(){t.off("click",o)})}}}t.$inject=["$document"],angular.module("app").directive("clickElsewhere",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s){function c(t,e){return t+"-"+e}function u(t,e,n,o){var i=r.getWordStatistic(t),a=r.getMsgStatistic(t);if(i){o=parseInt(o);var s=parseInt(i[e])-o;i[e]=0>s?0:s,i[n]=parseInt(i[n])+o}if(a){var c=parseInt(a[e])-1;a[e]=0>c?0:c,a[n]=parseInt(a[n])+1}}var l=this,d={};return l.findAll=function(t,o){var r=e(n.DOCUMENT_LIST_URL,{},{query:{method:"GET",params:{projectSlug:t,versionSlug:o},isArray:!0}});return r.query().$promise},l.getStatistics=function(o,r,i,u){if(i&&u){var f=c(i,u);if(a.has(d,f))return t.when(d[f]);var S=l.encodeDocId(i),g=e(n.DOC_STATISTIC_URL,{},{query:{method:"GET",params:{projectSlug:o,versionSlug:r,docId:S,localeId:u},isArray:!0}});return g.query().$promise.then(function(t){return a.forEach(t,function(t){t[s.getId("needswork")]=t.needReview||0}),d[f]=t,d[f]})}},l.encodeDocId=function(t){return t?t.replace(/\//g,","):t},l.decodeDocId=function(t){return t?t.replace(/\,/g,"/"):t},l.containsDoc=function(t,e){return a.any(t,function(t){return o.equals(t.name,e,!0)})},l.updateStatistic=function(t,e,n,o,r,s,l){var f=c(n,o);a.has(d,f)&&(u(d[f],r,s,l),i.emitEvent(i.EVENT.REFRESH_STATISTIC,{projectSlug:t,versionSlug:e,docId:n,localeId:o}))},l}t.$inject=["$q","$resource","UrlService","StringUtil","StatisticUtil","EventService","_","TransStatusService"],angular.module("app").factory("DocumentService",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a){var s,c=this,u=t.$new(),l=o.openClass,d=angular.noop,f=e.onToggle?n(e.onToggle):angular.noop;this.init=function(o){c.$element=o,e.isOpen&&(s=n(e.isOpen),d=s.assign,t.$watch(s,function(t){u.isOpen=!!t}))},this.toggle=function(t){return u.isOpen=arguments.length?!!t:!u.isOpen,u.isOpen},this.isOpen=function(){return u.isOpen},u.getToggleElement=function(){return c.toggleElement},u.focusToggleElement=function(){c.toggleElement&&c.toggleElement[0].focus()},u.$watch("isOpen",function(e,n){i[e?"addClass":"removeClass"](c.$element,l),e?(a(function(){u.focusToggleElement()}),r.open(u)):r.close(u),d(t,e),angular.isDefined(e)&&e!==n&&f(t,{open:!!e})}),t.$on("$locationChangeSuccess",function(){u.isOpen=!1}),t.$on("$destroy",function(){u.$destroy()}),t.$on("openDropdown",function(){u.isOpen=!0}),t.$on("closeDropdown",function(){u.isOpen=!1})}t.$inject=["$scope","$attrs","$parse","dropdownConfig","DropdownService","$animate","$timeout"],angular.module("app").controller("DropdownCtrl",t)}(),function(){"use strict";function t(t){var e=null,n=this;n.open=function(n){e||(t.bind("click",o),t.bind("keydown",r)),e&&e!==n&&(e.isOpen=!1),e=n},n.close=function(n){e===n&&(e=null,t.unbind("click",o),t.unbind("keydown",r))};var o=function(t){if(e){var n=e.getToggleElement();t&&n&&n[0].contains(t.target)||e.$apply(function(){e.isOpen=!1})}},r=function(t){27===t.which&&(e.focusToggleElement(),o())}}t.$inject=["$document"],angular.module("app").service("DropdownService",t)}(),function(){"use strict";var t={openClass:"is-active"};angular.module("app").constant("dropdownConfig",t)}(),function(){"use strict";function t(){return{restrict:"EA",controller:"DropdownCtrl",link:function(t,e,n,o){o.init(e)}}}function e(){return{restrict:"A",require:"?^dropdown",scope:{callback:"&onCloseDropdown"},link:function(t,e,n,o){o.onCloseDropdown=t.callback}}}function n(){return{restrict:"EA",require:"?^dropdown",link:function(t,e,n,o){if(o){o.toggleElement=e;var r=function(r){r.preventDefault(),r.stopPropagation(),e.hasClass("disabled")||n.disabled||t.$apply(function(){o.toggle()})};e.bind("click",r),e.attr({"aria-haspopup":!0,"aria-expanded":!1}),t.$watch(o.isOpen,function(n){e.attr("aria-expanded",!!n),o.onCloseDropdown&&!n&&t.$applyAsync(o.onCloseDropdown)}),t.$on("$destroy",function(){e.unbind("click",r)})}}}}angular.module("app").directive("dropdown",t).directive("onCloseDropdown",e).directive("dropdownToggle",n)}(),function(){"use strict";function t(t){var e=this;return e.EVENT={LOADING_START:"loadingStart",LOADING_STOP:"loadingStop",SELECT_TRANS_UNIT:"selectTransUnit",COPY_FROM_SOURCE:"copyFromSource",COPY_FROM_SUGGESTION:"copyFromSuggestion",COPY_FROM_SUGGESTION_N:"copyFromSuggestionN",UNDO_EDIT:"undoEdit",CANCEL_EDIT:"cancelEdit",FOCUS_TRANSLATION:"focusTranslation",SAVE_TRANSLATION:"saveTranslation",SAVE_INITIATED:"saveInitiated",SAVE_COMPLETED:"saveCompleted",TRANSLATION_TEXT_MODIFIED:"translationTextModified",REFRESH_STATISTIC:"refreshStatistic",GOTO_PREV_PAGE:"gotoPreviousPage",GOTO_NEXT_PAGE:"gotoNextPage",GOTO_FIRST_PAGE:"gotoFirstPage",GOTO_LAST_PAGE:"gotoLastPage",GOTO_NEXT_ROW:"gotoNextRow",GOTO_PREVIOUS_ROW:"gotoPreviousRow",GOTO_NEXT_UNTRANSLATED:"gotoNextUntranslated",TOGGLE_SAVE_OPTIONS:"openSaveOptions",FILTER_TRANS_UNIT:"filterTransUnit",PHRASE_SUGGESTION_COUNT:"phraseSuggestionCount",REQUEST_PHRASE_SUGGESTIONS:"requestPhraseSuggestions",REQUEST_TEXT_SUGGESTIONS:"requestTextSuggestions",SUGGESTIONS_SEARCH_TOGGLE:"suggestionsSearchToggle",USER_SETTING_CHANGED:"userSettingChanged"},e.broadcastEvent=function(e,n,o){o=o||t,o.$broadcast(e,n)},e.emitEvent=function(e,n,o){o=o||t,o.$emit(e,n)},e}t.$inject=["$rootScope"],angular.module("app").factory("EventService",t)}(),function(){"use strict";function t(t){return{restrict:"E",required:["name"],scope:{name:"@",title:"@",size:"@"},link:function(e,n){var o="",r="",i="";n.addClass("Icon"),e.title&&(i="<title>"+e.title+"</title>"),"loader"===e.name?(n.addClass("Icon--loader"),r='<span class="Icon-item"><span class="Icon--loader-dot"></span><span class="Icon--loader-dot"></span><span class="Icon--loader-dot"></span></span>',n.html(t.trustAsHtml(r))):(o='<svg class="Icon-item"><use xlink:href="#Icon-'+e.name+'" />'+i+"</svg>",n.html(t.trustAsHtml(o)))}}}t.$inject=["$sce"],angular.module("app").directive("icon",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(e,n){var r=o(t.LOCALE_LIST_URL,{},{query:{method:"GET",params:{projectSlug:e,versionSlug:n},isArray:!0}});return r.query().$promise}function a(){var e=o(t.ALL_LOCALE_URL,{},{query:{method:"GET",isArray:!0}});return e.query().$promise.then(function(t){d=n.cleanResourceList(t)})}function s(){var e=o(t.uiTranslationListURL,{},{query:{method:"GET"}});return e.query().$promise}function c(t,n){return t?r.find(t,function(t){return e.equals(t.localeId,n,!0)}):void 0}function u(t,n){return r.any(t,function(t){return e.equals(t.localeId,n,!0)})}function l(t){var e=c(d,t);return e?e.name:t}var d=[];return{getSupportedLocales:i,getUILocaleList:s,getLocaleByLocaleId:c,getAllLocales:a,containsLocale:u,getName:l,DEFAULT_LOCALE:{localeId:"en-US",name:"English"}}}t.$inject=["UrlService","StringUtil","FilterUtil","$resource","_"],angular.module("app").factory("LocaleService",t)}(),function(){"use strict";function t(t){return{restrict:"EA",scope:{loading:"=",inverted:"="},link:function(e){e.classes="",e.$on(t.EVENT.LOADING_START,function(){e.classes+=" is-loading"}),e.$on(t.EVENT.LOADING_STOP,function(){e.classes=e.classes.replace("is-loading","")}),e.$watch("inverted",function(t){t?e.classes+=" LogoLoader--inverted":e.classes=e.classes.replace("LogoLoader--inverted","")})},templateUrl:"components/logo-loader/logo-loader.html"}}t.$inject=["EventService"],angular.module("app").directive("logoLoader",t)}(),function(){"use strict";function t(){return{displayError:function(t){console.error(t)},displayWarning:function(t){console.warn(t)},displayInfo:function(t){console.info(t)}}}angular.module("app").factory("MessageHandler",t)}(),function(){"use strict";function t(){}angular.module("app").factory("NotificationService",t)}(),function(){"use strict";function t(t,e,n,o,r,i){function a(t,e,n,o){return t+"-"+e+"-"+n+"-"+o}var s=this,c={},u={};return s.getStates=function(s,u,l,d){var f=a(s,u,l,d);if(i.has(c,f))return t.when(c[f]);var S=r.encodeDocId(l),g={query:{method:"GET",params:{projectSlug:s,versionSlug:u,docId:S,localeId:d},isArray:!0}},E=e(o.TRANSLATION_STATUS_URL,{},g);return E.query().$promise.then(function(t){return t=n.cleanResourceList(t),c[f]=t,c[f]})},s.getTransUnits=function(r,a){function s(t){t=n.cleanResourceMap(t);for(var e in t)u[e][a]=t[e][a],l[e]=u[e];return l}function c(t){t=n.cleanResourceMap(t);for(var e in t)u[e]=t[e],l[e]=u[e];return l}var l={},d=[],f=[];if(r.forEach(function(t){i.has(u,t)?u[t][a]?l[t]=u[t]:f.push(t):d.push(t)}),i.isEmpty(d)&&i.isEmpty(f))return t.when(l);var S,g;return i.isEmpty(d)||(S=e(o.TEXT_FLOWS_URL,{},{query:{method:"GET",params:{localeId:a,ids:d.join(",")}}})),i.isEmpty(f)||(g=e(o.TRANSLATION_URL,{},{query:{method:"GET",params:{localeId:a,ids:f.join(",")}}})),S&&g?S.query().$promise.then(c).then(g.query().$promise.then(s)):S?S.query().$promise.then(c):g?g.query().$promise.then(s):void 0},s.onTransUnitUpdated=function(t,e,n,o,r,s){var l=a(t.projectSlug,t.versionSlug,t.docId,n),d=i.find(c[l],function(t){return t.id===e});d&&(d.state=r);var f=u[e][n];f||(f={}),f.revision=parseInt(o),f.state=r,f.contents=s.newTranslations.slice()},s}t.$inject=["$q","$resource","FilterUtil","UrlService","DocumentService","_"],angular.module("app").factory("PhraseCache",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(t,e){return o.find(e,function(e){return e.id===t})}function a(e,n){return n&&(e=t.filterResources(e,["status"],n)),o.map(e,function(t){return t.id})}var s={};return s.phrases=[],s.getPhraseCount=function(t,n){return e.getStates(t.projectSlug,t.versionSlug,t.docId,t.localeId).then(function(t){var e=a(t,n.status);return e.length})},s.fetchAllPhrase=function(t,r,i,c){function u(t){var n=a(t,r.status);return isNaN(i)||(n=isNaN(c)?n.slice(i):n.slice(i,i+c)),e.getTransUnits(n,S).then(l).then(f)}function l(t){return o.map(t,function(t,e){var o=t.source,r=t[S];return{id:parseInt(e),sources:o.plural?o.contents:[o.content],translations:d(o,r),newTranslations:d(o,r),plural:o.plural,status:n.getStatusInfo(r?r.state:"untranslated"),revision:r?parseInt(r.revision):0,wordCount:parseInt(o.wordCount)}})}function d(t,e){return t.plural?e&&e.contents?e.contents.slice():[]:e?[e.content]:[]}function f(n){return e.getStates(t.projectSlug,t.versionSlug,t.docId,S).then(function(t){return s.phrases=o.sortBy(n,function(e){var r=o.findIndex(t,function(t){return t.id===e.id});return r>=0?r:n.length}),s.phrases})}var S=t.localeId;return e.getStates(t.projectSlug,t.versionSlug,t.docId,S).then(u)},s.onTransUnitUpdated=function(t,o,r,a,c,u){e.onTransUnitUpdated(t,o,r,a,c,u);var l=i(o,s.phrases);l&&(l.translations=u.newTranslations.slice(),l.revision=a,l.status=n.getStatusInfo(c))},s.onTransUnitUpdateFailed=function(t){var e=i(t,s.phrases);e&&(e.newTranslations=e.translations.slice())},s.findNextId=function(t){return e.getStates(r.projectSlug,r.versionSlug,r.docId,r.localeId).then(function(e){var n,r;return n=o.findIndex(e,function(e){return e.id===t}),r=n+1<e.length?n+1:e.length-1,e[r].id})},s.findPreviousId=function(t){return e.getStates(r.projectSlug,r.versionSlug,r.docId,r.localeId).then(function(e){var n,r;return n=o.findIndex(e,function(e){return e.id===t}),r=n-1>=0?n-1:0,e[r].id})},s.findNextStatus=function(t,i){return e.getStates(r.projectSlug,r.versionSlug,r.docId,r.localeId).then(function(e){var r,a,s=n.getStatusInfo(i);r=o.findIndex(e,function(e){return e.id===t});for(var c=r+1;c<e.length;c++)if(a=n.getStatusInfo(e[c].state),a.ID===s.ID)return e[c].id;return t})},s}t.$inject=["FilterUtil","PhraseCache","TransStatusService","_","$stateParams"],angular.module("app").factory("PhraseService",t)}(),function(){"use strict";function t(){return{restrict:"E",required:"progressbarStatistic",scope:{statistic:"=progressbarStatistic",size:"@"},templateUrl:"components/progressbar/progressbar.html",controller:["$scope",function(t){t.$watch("statistic",function(n){n&&(t.style=e(n))},!0)}]}}function e(t){var e=t.total,o=n(t.approved,e),r=n(t.translated,e),i=o,a=n(t.needswork,e),s=o+r,c=n(t.untranslated,e),u=o+r+a,l={};return l.approved={width:o+"%",marginLeft:0},l.translated={width:r+"%",marginLeft:i+"%"},l.needsWork={width:a+"%",marginLeft:s+"%"},l.untranslated={width:c+"%",marginLeft:u+"%"},l}function n(t,e){var n=0;return t&&(n=t/e*100),n}angular.module("app").directive("progressbar",t)}(),function(){"use strict";function t(t,e){function n(n){var o={query:{method:"GET",params:{projectSlug:n}}},r=e(t.PROJECT_URL,{},o);return r.query().$promise}return{getProjectInfo:n}}t.$inject=["UrlService","$resource"],angular.module("app").factory("ProjectService",t)
}(),function(){"use strict";function t(){function t(t,e){return t.replace(e.regex,e.template)}var e={space:{regex:/ /g,template:'<span class="u-textSpace"> </span>'},newline:{regex:/\n/g,template:'<span class="u-textPilcrow"></span>\n'},tab:{regex:/\t/g,template:'<span class="u-textTab">	</span>'}};return{restrict:"A",required:["ngBind"],scope:{ngBind:"="},link:function(n,o){n.$watch("ngBind",function(n){n=t(n,e.space),n=t(n,e.newline),n=t(n,e.tab),o.html(n)})}}}angular.module("app").directive("renderWhitespaceCharacters",t)}(),function(){"use strict";function t(t,e,n,o){function r(r,i,a){function s(){t.update(t.SETTING.SUGGESTIONS_PANEL_HEIGHT,r.actualPosition)}function c(t){if(t)r.actualPosition=r.position,r.actualHeight=r.height;else{var e=r.actualPosition;r.position=e,r.actualPosition=0,r.actualHeight=0}setTimeout(S)}function u(t){"vertical"===a.resizer?l(t.pageX):d(e.innerHeight-t.pageY)}function l(t){var n=t,o=angular.element(document.querySelector(a.resizerLeft)),s=angular.element(document.querySelector(a.resizerRight)),c=E(a.resizerMax,e.innerHeight),u=a.resizerMin||parseInt(a.resizerWidth);r.actualPosition=n,n=g(n,c,u),i.css({left:n-r.actualHeight/2+"px"}),o.css({width:n+"px"}),s.css({left:n+"px"})}function d(t){var n=t,o=angular.element(document.querySelector(a.resizerTop)),s=angular.element(document.querySelector(a.resizerBottom)),c=E(a.resizerMax,e.innerHeight),u=a.resizerMin||r.actualHeight;r.actualPosition=n,n=g(n,c,u),i.css({bottom:n-r.actualHeight/2+"px"}),o.css({bottom:n+"px"}),s.css({height:n+"px"})}function f(){n.unbind("mousemove",u),n.unbind("mouseup",f),s()}function S(){"vertical"===a.resizer?l(r.actualPosition):d(r.actualPosition)}function g(t,e,n){return e&&t>e?e:n>t?n:t}function E(t,e){return/[0-9]*\.?[0-9]+%/.test(t)?Math.round(e*(parseInt(t.replace("%",""))/100)):parseInt(t)}r.height=parseInt(a.resizerHeight),r.actualHeight=r.height,r.position=E(t.get(t.SETTING.SUGGESTIONS_PANEL_HEIGHT),e.innerHeight),r.actualPosition=r.position,r.show=t.subscribe(t.SETTING.SHOW_SUGGESTIONS,function(t){r.show=t,c(t)}),c(r.show),i.addClass("Resizer"),"vertical"===a.resizer?(i.addClass("Resizer--vertical"),o(function(){l(r.actualPosition)})):(i.addClass("Resizer--horizontal"),o(function(){d(r.actualPosition)})),i.on("mousedown",function(t){t.preventDefault(),n.on("mousemove",u),n.on("mouseup",f)}),angular.element(e).bind("resize",function(){o.cancel(r.resizing),r.resizing=o(S)})}return{link:r}}t.$inject=["SettingsService","$window","$document","$timeout"],angular.module("app").directive("resizer",t)}(),function(){"use strict";function t(){var t=this;t.init=function(){var e=t.container[0],n=t.child[0],o=n.offsetWidth-e.offsetWidth;t.width=o/2}}angular.module("app").controller("ScrollbarWidthCtrl",t)}(),function(){"use strict";function t(){return{restrict:"A",controller:"ScrollbarWidthCtrl as scrollbarWidthCtrl",link:function(t,e,n,o){o.init(e)}}}function e(){return{restrict:"A",require:"?^scrollbarWidth",link:function(t,e,n,o){o&&e.css(n.scrollbarWidthElement,o.width)}}}function n(){return{restrict:"A",require:"?^scrollbarWidth",link:function(t,e,n,o){o&&(o.container=e)}}}function o(){return{restrict:"A",require:"?^scrollbarWidth",link:function(t,e,n,o){o&&(o.child=e)}}}angular.module("app").directive("scrollbarWidth",t).directive("scrollbarWidthElement",e).directive("scrollbarWidthContainer",n).directive("scrollbarWidthChild",o)}(),function(){"use strict";function t(t,e,n,o){function r(e,n){c(n);var r={};r[e]=n,o.extend(f,r),t.emitEvent(t.EVENT.USER_SETTING_CHANGED,{setting:e,value:n})}function i(t){o.each(t,function(t,e){r(e,t)})}function a(t){return o.has(f,t)?f[t]:void console.error("Tried to look up setting with unrecognized key: %s",t)}function s(e,o){return n.$on(t.EVENT.USER_SETTING_CHANGED,function(t,n){n.setting===e&&o(n.value)}),a(e)}function c(t){switch(typeof t){case"boolean":case"number":case"string":break;default:throw new Error('Invalid type for setting value: "'+typeof t+'".')}}var u=this;u.SETTING={SUGGESTIONS_AUTOFILL_ON_ROW_SELECT:"suggestionsAutofillOnRowSelect",SUGGESTIONS_SHOW_DIFFERENCE:"suggestionsShowDifference",SHOW_SUGGESTIONS:"showSuggestions",SUGGESTIONS_PANEL_HEIGHT:"suggestionsPanelHeight"};var l=u.SETTING,d={};d[l.SUGGESTIONS_AUTOFILL_ON_ROW_SELECT]=!0,d[l.SUGGESTIONS_SHOW_DIFFERENCE]=!1,d[l.SHOW_SUGGESTIONS]=!0,d[l.SUGGESTIONS_PANEL_HEIGHT]="30%";var f=o.clone(d);return{SETTING:l,update:r,updateAll:i,get:a,subscribe:s}}t.$inject=["EventService","$q","$rootScope","_"],angular.module("app").factory("SettingsService",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(){return g}function a(){return E?E.sources:[]}function s(){return p}function c(t){m=t,T||u()}function u(){var t=v+f,e=t-Date.now(),n=e>0?e:f;T=o(function(){return T=null,h>=S?void u():void l()},n)}function l(){if(null!==m){var t=m;m=null,o.cancel(T),T=null,d(t)}}function d(t){E=t;var e=Date.now();v=e,h++,n.getSuggestionsForPhrase(t).then(function(t){e>I&&(I=e,p=t)},function(t){console.error("Error searching for phrase ",t)})["finally"](function(){h--,r.$broadcast("PhraseSuggestionsService:updated"),S>h&&l()})}var f=300,S=3,g=!1,E=null,p=[],T=null,h=0,v=Date.now(),I=Date.now(),m=null;return r.$on(e.EVENT.REQUEST_PHRASE_SUGGESTIONS,function(t,e){var n=e.phrase;if(!(m&&m.id===n.id||!m&&0===h&&E&&E.id===n.id)){if(h>=S)return void c(n);var o=v+f;if(Date.now()<o)return void c(n);p=[],r.$broadcast("PhraseSuggestionsService:updated"),d(n)}}),{isLoading:i,getSearchStrings:a,getResults:s}}t.$inject=["_","EventService","SuggestionsService","$timeout","$rootScope"],angular.module("app").factory("PhraseSuggestionsService",t)}(),function(){"use strict";function t(t,e,n,o,r){var i=this;for(i.copyButtonText="Copy Translation";n.search.length<n.suggestion.sourceContents.length;)n.search.push("");return i.rowDisplayType=function(){var t=i.topMatch();if("IMPORTED_TM"===t.type)return"secondary";if("LOCAL_PROJECT"===t.type){if("Translated"===t.contentState)return"success";if("Approved"===t.contentState)return"highlight"}console.error("Unable to generate row display type for top match")},i.percentDisplayType=function(){var t=i.rowDisplayType();return t.charAt(0).toUpperCase()+t.substring(1)},i.percent=function(){var t=n.suggestion.similarityPercent;return t>99.99&&100>t?"99.99":t>=99.9&&100>t?"99.9":Math.round(t)!==t?t.toFixed(1):t},i.topMatch=function(){return n.suggestion.matchDetails[0]},i.showSuggestionCopied=function(){i.copyButtonText="Copied",i.copyButtonDisabled=!0,r(function(){i.copyButtonDisabled=!1,i.copyButtonText="Copy Translation"},500)},i.copySuggestion=function(){i.showSuggestionCopied(),t.emitEvent(t.EVENT.COPY_FROM_SUGGESTION,{suggestion:n.suggestion})},n.$on("EditorSuggestionsCtrl:nth-suggestion-copied",function(t,e){e===n.index&&i.showSuggestionCopied()}),n.detail=i.topMatch(),n.user=n.detail.lastModifiedBy||"Annoymous",n.remaining=n.suggestion.matchDetails.length-1,n.isTextFlow="LOCAL_PROJECT"===n.detail.type,i}t.$inject=["EventService","$rootScope","$scope","_","$timeout"],angular.module("app").controller("SuggestionCtrl",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(t){return s([t])}function a(t){return s(t.sources).then(function(n){return e.emitEvent(e.EVENT.PHRASE_SUGGESTION_COUNT,{id:t.id,count:n.length}),n})}function s(e){var o=t.context.srcLocale.localeId,i=t.context.localeId,a={query:{method:"POST",params:{from:o,to:i,searchType:"FUZZY_PLURAL"},isArray:!0}},s=r(n.SUGGESTIONS_URL,{},a);return s.query({},e).$promise.then(c)}function c(t){return o.chain(t).map(l).map(u).sortBy(["similarityPercent","bestMatchScore","bestMatchModificationDate","relevanceScore"]).reverse().value()}function u(t){var e,n,r=t.matchDetails[0];return"LOCAL_PROJECT"===r.type&&(e=r.lastModifiedDate,n="Translated"===r.contentState?0:1),"IMPORTED_TM"===r.type&&(e=r.lastChanged,n=2),o.assign({},t,{bestMatchScore:n,bestMatchModificationDate:e})}function l(t){var e=o.sortBy(t.matchDetails,d);return o.assign({},t,{matchDetails:e})}function d(t){if("IMPORTED_TM"===t.type)return"3"+t.lastChanged;if("LOCAL_PROJECT"===t.type){if("Translated"===t.contentState)return"2"+t.lastModifiedDate;if("Approved"===t.contentState)return"1"+t.lastModifiedDate}return"9"}return{getSuggestionsForPhrase:a,getSuggestionsForText:i}}t.$inject=["EditorService","EventService","UrlService","_","$resource"],angular.module("app").factory("SuggestionsService",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(){return T>0}function a(){return g?[g]:[]}function s(){return E}function c(t){I=t,p||u()}function u(){var t=h+f,e=t-Date.now(),n=e>0?e:f;p=r(function(){return p=null,T>=S?void u():void l()},n)}function l(){if(null!==I){var t=I;I=null,r.cancel(p),p=null,d(t)}}function d(t){g=t;var e=Date.now();h=e,T++,n.getSuggestionsForText(t).then(function(t){e>v&&(v=e,E=t)},function(t){console.error("Error searching for text ",t)})["finally"](function(){T--,o.$broadcast("TextSuggestionsService:updated"),S>T&&l()})}var f=300,S=3,g=null,E=[],p=null,T=0,h=Date.now(),v=Date.now(),I=null;return o.$on(e.EVENT.REQUEST_TEXT_SUGGESTIONS,function(t,e){if(!(I&&I===e||!I&&0===T&&g===e)){if(""===e)return g=e,E=[],I=null,r.cancel(p),p=null,h=Date.now,v=Date.now(),void o.$broadcast("TextSuggestionsService:updated");if(T>=S)return void c(e);var n=h+f;if(Date.now()<n)return void c(e);E=[],o.$broadcast("TextSuggestionsService:updated"),d(e)}}),{isLoading:i,getSearchStrings:a,getResults:s}}t.$inject=["_","EventService","SuggestionsService","$rootScope","$timeout"],angular.module("app").factory("TextSuggestionsService",t)}(),function(){"use strict";function t(){return{restrict:"E",scope:{suggestion:"=",index:"=",search:"=",diffEnabled:"="},controller:"SuggestionCtrl as suggestionCtrl",templateUrl:"components/suggestions/suggestion.html"}}angular.module("app").directive("suggestion",t)}(),function(){"use strict";function t(){return{restrict:"A",link:function(t,e){e.after('<span class="Toggle-fakeCheckbox"></span>')}}}angular.module("app").directive("toggleCheckbox",t)}(),function(){"use strict";function t(t){function e(t){return t=angular.uppercase(t),t&&"NEW"!==t?"NEEDREVIEW"===t&&(t="NEEDSWORK"):t="UNTRANSLATED",t}function n(t){return t=angular.lowercase(t),t&&"untranslated"!==t?"needswork"===t?"NeedReview":t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():"New"}var o=this,r={UNTRANSLATED:{ID:"untranslated",NAME:"Untranslated",CSSCLASS:"neutral"},NEEDSWORK:{ID:"needswork",NAME:"Needs Work",CSSCLASS:"unsure"},TRANSLATED:{ID:"translated",NAME:"Translated",CSSCLASS:"success"},APPROVED:{ID:"approved",NAME:"Approved",CSSCLASS:"highlight"}};return o.getAll=function(){return r},o.getAllAsArray=function(){return t.values(r)},o.getStatusInfo=function(t){return r[e(t)]},o.getId=function(t){return r[e(t)].ID},o.getServerId=function(t){return n(t)},o.getName=function(t){return r[e(t)].NAME},o.getCSSClass=function(t){return r[e(t)].CSSCLASS},o}t.$inject=["_"],angular.module("app").factory("TransStatusService",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c,u,l,d){function f(){S.selected||e.$apply(function(){a.emitEvent(a.EVENT.SELECT_TRANS_UNIT,{id:e.phrase.id,updateURL:!0,focus:!0},e)})}var S=this;S.selected=!1,S.focused=!1,S.focusedTranslationIndex=0,S.hasTranslationChanged=l.hasTranslationChanged,S.focusTranslation=function(){S.selected&&c("phrase-"+e.phrase.id+"-"+S.focusedTranslationIndex)},S.onTextAreaFocus=function(t,n){S.focused=!0,r.isUndefined(n)||(S.focusedTranslationIndex=n),S.selected||a.emitEvent(a.EVENT.SELECT_TRANS_UNIT,{id:t.id,updateURL:!0,focus:!0},e)},S.translationTextModified=function(t){a.emitEvent(a.EVENT.TRANSLATION_TEXT_MODIFIED,t)},S.getPhrase=function(){return e.phrase},S.init=function(){i.addController(e.phrase.id,S),o.id&&parseInt(o.id)===e.phrase.id&&a.emitEvent(a.EVENT.SELECT_TRANS_UNIT,{id:o.id,updateURL:!1,focus:o.selected})},S.copySource=function(t,n,o){t.stopPropagation(),a.emitEvent(a.EVENT.COPY_FROM_SOURCE,{phrase:n,sourceIndex:o},e)},S.undoEdit=function(t,n){t.stopPropagation(),a.emitEvent(a.EVENT.UNDO_EDIT,n,e)},S.cancelEdit=function(t,n){t.stopPropagation(),a.emitEvent(a.EVENT.CANCEL_EDIT,n,e)},S.saveAs=function(t,e,n){u.saveTranslationCallBack(t,e,n)},S.getLocaleName=function(t){return s.getName(t)},S.toggleSaveAsOptions=function(t){a.broadcastEvent(t?"openDropdown":"closeDropdown",{},e),t&&c(e.phrase.id+"-saveAsOption-0")};var g=d.SETTING.SHOW_SUGGESTIONS;return e.showSuggestions=d.subscribe(g,function(t){e.showSuggestions=t}),t.$on(a.EVENT.SUGGESTIONS_SEARCH_TOGGLE,function(t,e){S.suggestionsSearchIsActive=e}),S.toggleSuggestionPanel=function(){S.suggestionsSearchIsActive?a.emitEvent(a.EVENT.SUGGESTIONS_SEARCH_TOGGLE,!1):d.update(g,!e.showSuggestions)},e.suggestionCount=0,t.$on(a.EVENT.PHRASE_SUGGESTION_COUNT,function(t,n){n.id===e.phrase.id&&(e.suggestionCount=n.count)}),S.cancelSaveAsMode=function(){u.cancelSaveAsModeIfOn()},e.$on("$destroy",function(){n.unbind("click",f),n.unbind("focus",f)}),S.updateSaveButton=function(t){S.saveButtonStatus=l.getSaveButtonStatus(e.phrase),S.saveButtonOptions=i.getSaveButtonOptions(S.saveButtonStatus,e.phrase),S.saveButtonText=S.saveButtonStatus.NAME,S.saveButtonDisabled=!l.hasTranslationChanged(t),S.loadingClass="",S.savingStatus=""},S.phraseSaving=function(t){S.loadingClass="is-loading",S.saveButtonStatus=S.savingStatus=t.status,S.saveButtonOptions=i.getSaveButtonOptions(S.saveButtonStatus,t.phrase),S.saveButtonText="Saving…",S.saveButtonDisabled=!0},S.saveButtonOptionsAvailable=function(){return!r.isEmpty(S.saveButtonOptions)},S.selectTransUnit=function(t){S.selected||a.emitEvent(a.EVENT.SELECT_TRANS_UNIT,{id:t.id,updateURL:!0,focus:!0},e)},S}t.$inject=["$rootScope","$scope","$element","$stateParams","_","TransUnitService","EventService","LocaleService","focus","EditorShortcuts","PhraseUtil","SettingsService"],angular.module("app").controller("TransUnitCtrl",t)}(),function(){"use strict";function t(t,e,n,o,r,i,a,s,c,u,l,d,f){function S(t,e){var n=0;if(t.plural){var o=N[t.id];n=o.focusedTranslationIndex}t.newTranslations[n]=e,s.emitEvent(s.EVENT.TRANSLATION_TEXT_MODIFIED,t),s.emitEvent(s.EVENT.FOCUS_TRANSLATION,t)}function g(t,e){t.newTranslations=e.slice(),s.emitEvent(s.EVENT.TRANSLATION_TEXT_MODIFIED,t),s.emitEvent(s.EVENT.FOCUS_TRANSLATION,t)}function E(t,e){var n=N[e.id];n.updateSaveButton(e)}function p(t,e){var n=N[e.phrase.id];n.phraseSaving(e),s.emitEvent(s.EVENT.FOCUS_TRANSLATION,e.phrase)}function T(t,e){t.selected!==e&&(t.selected=e||!1)}function h(t,e){var n=N[e.id];n.focusTranslation()}function v(t,e){var n=[];return"untranslated"===t.ID?n:(n=i("filter")(c.getAllAsArray(),{ID:"!untranslated"}),e.plural&&(d.hasNoTranslation(e)?n=i("filter")(n,{ID:"!needswork"}):d.hasEmptyTranslation(e)&&(n=i("filter")(n,{ID:"!translated"}))),u&&(n=i("filter")(n,{ID:"!approved"})),i("filter")(n,{ID:"!"+t.ID}))}var I,m=this,N={};return m.addController=function(t,e){N[t]=e},m.getSaveButtonOptions=function(t,e){return v(t,e)},n.$on(s.EVENT.TOGGLE_SAVE_OPTIONS,function(t,e){var n=N[e.id];n&&n.toggleSaveAsOptions(e.open)}),n.$on(s.EVENT.SELECT_TRANS_UNIT,function(t,n){var i=N[n.id],u=N[I],f=n.updateURL;s.emitEvent(s.EVENT.REQUEST_PHRASE_SUGGESTIONS,{phrase:i.getPhrase()}),i?(l.selectedTUCtrl=i,I&&I!==n.id&&(T(u,!1),d.hasTranslationChanged(u.getPhrase())&&s.emitEvent(s.EVENT.SAVE_TRANSLATION,{phrase:u.getPhrase(),status:c.getStatusInfo("TRANSLATED"),locale:r.localeId,docId:r.docId})),E(t,i.getPhrase()),I=n.id,T(i,!0),s.emitEvent(s.EVENT.FOCUS_TRANSLATION,n),f&&("editor.selectedContext.tu"!==o.current.name?o.go("editor.selectedContext.tu",{id:n.id,selected:n.focus.toString()}):(e.search("id",n.id),e.search("selected",n.focus.toString())))):a.displayWarning("Trans-unit not found:"+n.id)}),n.$on(s.EVENT.COPY_FROM_SOURCE,function(e,n){var o=0;if(n.phrase.plural&&(o=n.sourceIndex,t.isUndefined(o))){var r=N[n.phrase.id];o=r.focusedTranslationIndex,n.phrase.sources.length<r.focusedTranslationIndex+1&&(o=n.phrase.sources.length-1)}S(n.phrase,n.phrase.sources[o])}),n.$on(s.EVENT.COPY_FROM_SUGGESTION,function(e,n){if(I){var o=N[I],r=o.getPhrase(),i=n.suggestion,a=i.targetContents,s=r.plural&&a.length>1;if(s){var c=r.translations.length;if(a.length<c){var u=t.last(a);a=t.assign(r.translations.slice(),a,function(t,e){return e?e:t?t:u})}a.length>c&&(a=t.first(a,c)),g(r,a)}else S(r,a[0])}}),n.$on(s.EVENT.UNDO_EDIT,function(t,e){d.hasTranslationChanged(e)&&g(e,e.translations)}),n.$on(s.EVENT.CANCEL_EDIT,function(t,o){I&&(T(N[I],!1),I=!1,l.selectedTUCtrl=null),e.search("selected",null),o||e.search("id",null),o&&f(function(){return n.$broadcast("blurOn","phrase-"+o.id)})}),n.$on(s.EVENT.TRANSLATION_TEXT_MODIFIED,E),n.$on(s.EVENT.FOCUS_TRANSLATION,h),n.$on(s.EVENT.SAVE_INITIATED,p),n.$on(s.EVENT.SAVE_COMPLETED,E),m}t.$inject=["_","$location","$rootScope","$state","$stateParams","$filter","MessageHandler","EventService","TransStatusService","PRODUCTION","EditorShortcuts","PhraseUtil","$timeout"],angular.module("app").factory("TransUnitService",t)}(),function(){"use strict";function t(){return{restrict:"E",required:["phrase","editorContext"],scope:{phrase:"=",firstPhrase:"=",editorContext:"="},controller:"TransUnitCtrl as transUnitCtrl",templateUrl:"components/transUnit/trans-unit.html",link:function(t,e,n,o){o.init()}}}angular.module("app").directive("transUnit",t)}(),function(){"use strict";function t(){return{restrict:"E",required:["editor"],scope:{editor:"="},templateUrl:"components/transUnitFilter/trans-unit-filter.html"}}angular.module("app").directive("transUnitFilter",t)}(),function(){"use strict";function t(t,e){function n(n){var o=t(e.USER_INFO_URL,{},{query:{method:"GET",params:{username:n}}});return o.query().$promise}function o(){var n=t(e.MY_INFO_URL,{},{query:{method:"GET"}});return n.query().$promise}return{settings:{editor:{hideMainNav:!1}},getUserInfo:n,getMyInfo:o}}t.$inject=["$resource","UrlService"],angular.module("app").factory("UserService",t)}(),function(){"use strict";function t(t,e){function n(t,n,o){return t&&n&&o?e.filter(t,function(t){return i(t,n,o)}):t}function o(t){var e={},n=Object.keys(t).filter(function(t){return-1===t.indexOf("$")});return n.forEach(function(n){e[n]=t[n]}),e}function r(t){var e=[],n=Object.keys(t).filter(function(t){return-1===t.indexOf("$")});return n.forEach(function(n){e.push(t[n])}),e}function i(n,o,r){return n&&o&&r?e.any(o,function(o){return e.any(r,function(e){return t.equals(n[o],e,!0)})}):!1}return{filterResources:n,cleanResourceList:r,cleanResourceMap:o}}t.$inject=["StringUtil","_"],angular.module("app").factory("FilterUtil",t)}(),function(){"use strict";function t(t,e){function n(e){return r(e)?t.getStatusInfo("untranslated"):i(e)?t.getStatusInfo("needswork"):o(e)?t.getStatusInfo("translated"):e.status}function o(t){var n=e.every(t.translations,function(e,n){return a(e)===a(t.newTranslations[n])});return!n}function r(t){return e.isEmpty(e.compact(t.newTranslations))}function i(t){return e.compact(t.newTranslations).length!==t.newTranslations.length}function a(t){return t||""}return{getSaveButtonStatus:n,hasTranslationChanged:o,hasNoTranslation:r,hasEmptyTranslation:i}}t.$inject=["TransStatusService","_"],angular.module("app").factory("PhraseUtil",t)}(),function(){"use strict";function t(){return{getWordStatistic:function(t){return"WORD"===t[0].unit?t[0]:t[1]},getMsgStatistic:function(t){return"MESSAGE"===t[0].unit?t[0]:t[1]}}}angular.module("app").factory("StatisticUtil",t)}(),function(){"use strict";function t(){function t(t,e,n){return n&&t&&e&&(t=t.toUpperCase(),e=e.toUpperCase()),0===t.lastIndexOf(e,0)}function e(t,e,n){return n&&t&&e&&(t=t.toUpperCase(),e=e.toUpperCase()),-1!==t.indexOf(e,t.length-e.length)}function n(t,e,n){return n&&t&&e&&(t=t.toUpperCase(),e=e.toUpperCase()),t===e}return{startsWith:t,endsWith:e,equals:n}}angular.module("app").factory("StringUtil",t)}(),function(){"use strict";function t(t,e,n,o,r){function i(){return l+Array.prototype.join.call(arguments,"")}function a(t){return function(e){return t(e)}}location.origin||(location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var s=this,c="http://www.gravatar.com/avatar",u="config.json",l="",d={},f=location.origin+location.pathname+"translations";return s.serverContextPath="",s.init=function(){return l?n.when(l):e.get(u).then(function(t){var e=t.data;if(e.baseUrl)l=e.baseUrl;else{var n=e.appPath.replace(/^\//g,""),o=location.href.indexOf(n);s.serverContextPath=location.origin+location.pathname,o>=0&&(s.serverContextPath=location.href.substring(0,o)),s.serverContextPath=s.serverContextPath.replace(/\/?$/,"/"),l=s.serverContextPath+"rest"}d=r.mapValues({project:"/project/:projectSlug",docs:"/project/:projectSlug/version/:versionSlug/docs",locales:"/project/:projectSlug/version/:versionSlug/locales",status:"/project/:projectSlug/version/:versionSlug/doc/:docId/status/:localeId",textFlows:"/source+trans/:localeId",docStats:"/stats/project/:projectSlug/version/:versionSlug/doc/:docId/locale/:localeId",myInfo:"/user",userInfo:"/user/:username",translation:"/trans/:localeId",allLocales:"/locales",suggestions:"/suggestions"},a(i)),s.PROJECT_URL=d.project,s.LOCALE_LIST_URL=d.locales,s.DOCUMENT_LIST_URL=d.docs,s.TRANSLATION_STATUS_URL=d.status,s.TEXT_FLOWS_URL=d.textFlows,s.DOC_STATISTIC_URL=d.docStats,s.MY_INFO_URL=d.myInfo,s.USER_INFO_URL=d.userInfo,s.TRANSLATION_URL=d.translation,s.ALL_LOCALE_URL=d.allLocales,s.SUGGESTIONS_URL=d.suggestions,s.PROJECT_PAGE=function(t,e){return s.serverContextPath+"iteration/view/"+t+"/"+e},s.DASHBOARD_PAGE=s.serverContextPath+"dashboard"})},s.readValue=function(e){return t.search()[e]},s.gravatarUrl=function(t,e){return c+"/"+t+"?d=mm&amp;r=g&amp;s="+e},s.uiTranslationURL=function(t){return f+"/"+t+".json"},s.uiTranslationListURL=f+"/locales",s}t.$inject=["$location","$http","$q","$stateParams","_"],angular.module("app").factory("UrlService",t)}();
//# sourceMappingURL=../maps/app.js.map